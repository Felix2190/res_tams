<?php

	#-----------------------------------------------------------------------------------------------------------------#
	#---------------------------------------Archivos necesarios Require Include---------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#

	require FOLDER_MODEL_WS . "ws.class.AccountService.EndpointList.inc.php";




	#-----------------------------------------------------------------------------------------------------------------#
	#--------------------------------------------Inicializacion de control--------------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#



	#-----------------------------------------------------------------------------------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#

	#-----------------------------------------------------------------------------------------------------------------#
	#----------------------------------------------------Funciones----------------------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#


	#-----------------------------------------------------------------------------------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#


	#-----------------------------------------------------------------------------------------------------------------#
	#---------------------------------------------------Seccion AJAX--------------------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#

	$xajax=new xajax();

	require LIB_REVISAR_PENDIENTES_XAJAX;



	$xajax->processRequest();

	#-----------------------------------------------------------------------------------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#

	#-----------------------------------------------------------------------------------------------------------------#
	#-------------------------------------------Inicializacion de variables-------------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#

	$Invoices=new DAccountServiceEndpointList();
	$Invoices->Param->setAccountId($objSession->getAccountId());
	$Invoices->execute();

	if($Invoices->getError())
		die($Invoices->getStrError());


	$strEndpoints="";

	$endPointList=array();


	foreach($Invoices->Response->getList() AS $k=>$v)
	{
		$endPointList[$v['Id']]=$v;

		$strEndpoints.='
				<tr>
					<td><a href="endpointsedit.php?id=' . $v['Id'] . '">' . $v['Name'] . '</a></td>
					<td class="hidden-xs">' . $v['Id'] . '</td>
					<td class="hidden-xs">'. $v['Lines'] .'</td>
					<td class="hidden-xs">' . $v['ProtocolName'] . '</td>
					<td>'. $v['MemberName'] .'</td>
				</tr>';
	}
	$_SESSION['endPointList']=serialize($endPointList);




	//require LIB_CONEXION;

	$SQL="SELECT count(*) as cuenta FROM endpointadd WHERE idAccount='" . $objSession->getAccountId() . "' AND estatus='pendiente'";
	//$record=mysql_query($SQL);
	$record=mysqli_query($dbLink,$SQL);
	if(!$record)
		die("Error" . mysql_error());
	$row=mysqli_fetch_assoc($record);

	if($row['cuenta']>0)
		$noTienenTrunk=false;
	else
	{
		if(count($endPointList)==0)
			$noTienenTrunk=true;
		else
			$noTienenTrunk=false;
	}
