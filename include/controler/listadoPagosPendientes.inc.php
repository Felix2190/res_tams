<?php

	#-----------------------------------------------------------------------------------------------------------------#
	#---------------------------------------Archivos necesarios Require Include---------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#




	#-----------------------------------------------------------------------------------------------------------------#
	#--------------------------------------------Inicializacion de control--------------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#



	#-----------------------------------------------------------------------------------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#

	#-----------------------------------------------------------------------------------------------------------------#
	#----------------------------------------------------Funciones----------------------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#
	
	function calcularTablaPagosPendientes()
	{
		global $objSession;
		global $dbLink;
		
		//var_dump($objSession->getIdUbicacion());
		
		
		$query="SELECT 
					D.idTurno, 
					D.turnoExterno, 
					D.personaNombre, CONCAT_WS(' ',personaprimerApellido,personaSegundoApellido) As personaApellidos, 
					T.nuevaCosto AS total,
					CONCAT_WS(' ',T.descripcion,T.tipo,T.periodo,'meses',T.tipoTramite) AS tramite
				FROM turnoDetalles As D
				INNER JOIN tipolicencia AS T ON T.idTipoLicencia=D.idTipoLicencia
				WHERE D.etapaDescripcion='pago'";
		
		$result=mysqli_query($dbLink, $query);
		if(!$result)
		{
			die("Error en la consulta");
		}
		
		$tabla="";
		while($r=mysqli_fetch_assoc($result))
		{
			/*
			<th>Turno</th>
			<th>Externo</th>
			<th>Folio Recaudaci&oacute;n</th>
			<th>Nombre(s)</th>														
			<th>Tipo de Licencia</th>
			<th>Total</th>														
			<th>Opciones</th>
			*/
			
			$tabla.='<tr>
						<td>' . $r["idTurno"] . '</td>
						<td>' . $r["turnoExterno"] . '</td>
						<td>' . $r["personaNombre"] . '</td>						
						<td>' . $r["tramite"] . '</td>
						<td>$ ' . number_format($r["total"],2 , "." , ",") . '</td>
						<td>
								<a href="generarPago.php?idT=' . $r['idTurno'] . '" class="btn btn-default" title="Proceder con pago" alt="Proceder con pago"><i class="fa fa-money"></i> </a>
						</td>
					</tr>';
			
		}
		
		return $tabla;
		
		/*
		<th>ID</th>
		<th>Externo</th>
		<th>Nombre(s)</th>
		<th>Apellidos</th>
		<th>Tipo de Licencia</th>
		<th>Opciones</th>
		*/
	}


	#-----------------------------------------------------------------------------------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#


	#-----------------------------------------------------------------------------------------------------------------#
	#---------------------------------------------------Seccion AJAX--------------------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#

	$xajax=new xajax();
	$xajax->processRequest();
	#-----------------------------------------------------------------------------------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#

	#-----------------------------------------------------------------------------------------------------------------#
	#-------------------------------------------Inicializacion de variables-------------------------------------------#
	#-----------------------------------------------------------------------------------------------------------------#
	
		
	$listadoPagosPendientes=calcularTablaPagosPendientes();
